From b7b849218802b7586c4688cb1e6ededf1fa2f0b5 Mon Sep 17 00:00:00 2001
From: Eric Naim <dnaim@cachyos.org>
Date: Mon, 13 Oct 2025 15:54:41 +0800
Subject: [PATCH 3/3] nvidia-uvm: Remove unused get_devmap_page() parameter

Signed-off-by: Eric Naim <dnaim@cachyos.org>
---
 kernel-open/nvidia-uvm/uvm_va_range_device_p2p.c | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/kernel-open/nvidia-uvm/uvm_va_range_device_p2p.c b/kernel-open/nvidia-uvm/uvm_va_range_device_p2p.c
index 8a5c87bd3c3a..767531bd2b3a 100644
--- a/kernel-open/nvidia-uvm/uvm_va_range_device_p2p.c
+++ b/kernel-open/nvidia-uvm/uvm_va_range_device_p2p.c
@@ -21,6 +21,8 @@
 
 *******************************************************************************/
 
+#include <linux/version.h>
+
 #include "uvm_common.h"
 #include "uvm_linux.h"
 #include "uvm_types.h"
@@ -360,7 +362,11 @@ static NV_STATUS alloc_device_p2p_mem(uvm_gpu_t *gpu,
         // a reference to them, so take one now if using DEVICE_COHERENT pages.
         if (gpu->parent->cdmm_enabled) {
             get_page(page);
+#if LINUX_VERSION_CODE < KERNEL_VERSION(6, 18, 0)
             get_dev_pagemap(page_to_pfn(page), NULL);
+#else
+            get_dev_pagemap(page_to_pfn(page));
+#endif /* < 6.18 */
         }
 #else
         // CDMM P2PDMA will never be enabled for this case
-- 
2.51.0

